void writeQuadtreeToQTC(const char* filename, Quadtree* tree, const char* identification_code, int width, int height, int levels) {
    FILE* file = fopen(filename, "wb");
    if (!file) {
        perror("Error opening file for writing");
        return;
    }

    // Step 1: Write the identification code (e.g., Q1)
    fwrite(identification_code, sizeof(char), 2, file);

    // Step 4: Write the metadata as comments
    fprintf(file, "\n# Metadata: Date and Time of Creation\n");
    char datetime[20];
    get_current_datetime(datetime, sizeof(datetime));
    fprintf(file, "# Created on: %s\n", datetime);

    // Calculate the compression rate
    int originalSize = width * height; // Assuming 1 byte per pixel for the original image
    int compressedSize = tree->treesize * (sizeof(unsigned char) * 3); // Each node has 3 unsigned char values
    double compressionRate = calculateCompressionRate(originalSize, compressedSize);
    fprintf(file, "# Compression Rate: %.2f\n", compressionRate);

    fprintf(file, "# This file contains quadtree data for an image.\n");

    // Step 2: Write the image size (width, height, number of levels)
    fwrite(&width, sizeof(int), 1, file);
    fwrite(&height, sizeof(int), 1, file);
    fwrite(&levels, sizeof(int), 1, file);

    // Step 3: Write the quadtree data (nodes of the quadtree)
    for (int i = 0; i < tree->treesize; i++) {
        Pixnode* node = &tree->Pixels[i];
        unsigned char e = node->e;
        unsigned char u = node->u;

        fwrite(&node->m, sizeof(unsigned char), 1, file);  // Write the average pixel value
        fwrite(&e, sizeof(unsigned char), 1, file);        // Write the error flag
        fwrite(&u, sizeof(unsigned char), 1, file);        // Write the uniformity flag
    }

    fclose(file);
}